---
import { getCollection } from 'astro:content';
import type { ImageMetadata } from 'astro';

// rank毎にコンテンツを取得
const ranks = ['platinum', 'gold', 'silver', 'bronze', 'lunch'];
const results = await Promise.all(
  ranks.map((rank) => getCollection('pek2025-job-boards', (board) => board.data.rank === rank))
);

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/images/pek2025/sponsor/logo/*.{jpeg,jpg,png,gif}'
);
console.log('images', images);
results.forEach((result) => {
  result.forEach((sponsor) => {
    if (!images[sponsor.data.image])
      throw new Error(
        `"${sponsor.data.name}:${sponsor.data.image}" does not exist in glob: "/src/assets/images/pek2025/sponsor/logo/*.{jpeg,jpg,png,gif}"`
      );
  });
});

// 画像パスを事前に解決
async function resolveSponsorsWithSrc(result) {
  return await Promise.all(result.map(async (sponsor) => {
    const mod = await images[sponsor.data.image]();
    return {
      src: mod.default.src,
      name: sponsor.data.name,
      href: sponsor.data.href,
    };
  }));
}

const [platinumSponsors, goldSponsors, silverSponsors, bronzeSponsors, lunchSponsors] = await Promise.all(
  results.map(resolveSponsorsWithSrc)
);
---

<section id="sponsor" class="py-12 space-y-8 mt-16 bg-white">
  <div class="container mx-auto px-4">
    <div class="text-center mb-12">
      <p class="text-base text-200 tracking-wide uppercase mb-1">sponsor</p>
      <h2 class="text-3xl md:text-4xl font-bold text-pek2025-primary-600 mb-4">スポンサー</h2>
      <p class="text-lg text-gray-700 max-w-2xl mx-auto">
        PEK2025の開催を支援していただいているスポンサー企業の皆様です
      </p>
    </div>

    <div class="max-w-6xl mx-auto">
      <div class="space-y-12">
        {/* Platinum Sponsors */}
        {
          platinumSponsors.length > 0 && (
            <div class="space-y-6">
              <div class="text-center">
                <h3 class="text-2xl font-bold text-pek2025-primary-700 mb-2">Platinum</h3>
                <div class="w-24 h-1 bg-gradient-to-r from-purple-300 to-purple-500 mx-auto rounded-full" />
              </div>
              <div class="flex flex-wrap justify-center gap-8">
                {platinumSponsors.map((sponsor) => (
                  <div class="flex-shrink-0 w-80 lg:w-72 bg-white border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                    <div class="bg-white rounded-xl p-6 flex items-center justify-center aspect-[4/2.5]">
                      <a
                        href={sponsor.href}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex items-center justify-center w-full h-full"
                      >
                        <img
                          src={sponsor.src}
                          alt={sponsor.name}
                          loading="lazy"
                          class="block object-contain max-w-[90%] max-h-[90%]"
                        />
                      </a>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )
        }

        {/* Gold Sponsors */}
        {
          goldSponsors.length > 0 && (
            <div class="space-y-6">
              <div class="text-center">
                <h3 class="text-2xl font-bold text-pek2025-primary-700 mb-2">Gold</h3>
                <div class="w-24 h-1 bg-gradient-to-r from-yellow-300 to-yellow-500 mx-auto rounded-full" />
              </div>
              <div class="flex flex-wrap justify-center gap-6">
                {goldSponsors.map((sponsor) => (
                  <div class="flex-shrink-0 w-72 lg:w-64 bg-white border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                    <div class="bg-white rounded-xl p-6 flex items-center justify-center aspect-[4/2.5]">
                      <a
                        href={sponsor.href}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex items-center justify-center w-full h-full"
                      >
                        <img
                          src={sponsor.src}
                          alt={sponsor.name}
                          loading="lazy"
                          class="block object-contain max-w-[90%] max-h-[90%]"
                        />
                      </a>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )
        }

        {/* Silver Sponsors */}
        {
          silverSponsors.length > 0 && (
            <div class="space-y-6">
              <div class="text-center">
                <h3 class="text-2xl font-bold text-pek2025-primary-700 mb-2">Silver</h3>
                <div class="w-24 h-1 bg-gradient-to-r from-gray-200 to-gray-400 mx-auto rounded-full" />
              </div>
              <div class="flex flex-wrap justify-center gap-6 max-w-4xl mx-auto">
                {silverSponsors.map((sponsor) => (
                  <div class="flex-shrink-0 w-64 lg:w-60 bg-white border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                    <div class="bg-white rounded-xl p-4 flex items-center justify-center aspect-[4/2.5]">
                      <a
                        href={sponsor.href}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex items-center justify-center w-full h-full"
                      >
                        <img
                          src={sponsor.src}
                          alt={sponsor.name}
                          loading="lazy"
                          class="block object-contain max-w-[90%] max-h-[90%]"
                        />
                      </a>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )
        }

        {/* Bronze Sponsors */}
        {
          bronzeSponsors.length > 0 && (
            <div class="space-y-6">
              <div class="text-center">
                <h3 class="text-2xl font-bold text-pek2025-primary-600 mb-2">Bronze</h3>
                <div class="w-24 h-1 bg-gradient-to-r from-yellow-600 to-yellow-800 mx-auto rounded-full" />
              </div>
              <div class="flex flex-wrap justify-center gap-4">
                {bronzeSponsors.map((sponsor) => (
                  <div class="flex-shrink-0 w-44 lg:w-40 bg-white border border-gray-200 p-[2px] rounded-lg shadow-md hover:shadow-xl transition-all duration-300">
                    <div class="bg-white rounded-lg p-3 flex items-center justify-center aspect-[4/2.5]">
                      <a
                        href={sponsor.href}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex items-center justify-center w-full h-full"
                      >
                        <img
                          src={sponsor.src}
                          alt={sponsor.name}
                          loading="lazy"
                          class="block object-contain max-w-[90%] max-h-[90%]"
                        />
                      </a>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )
        }

        {/* Lunch Sponsors */}
        {
          lunchSponsors.length > 0 && (
            <div class="space-y-6">
              <div class="text-center">
                <h3 class="text-2xl font-bold text-pek2025-primary-600 mb-2">Lunch</h3>
                <div class="w-24 h-1 bg-gradient-to-r from-green-300 to-green-500 mx-auto rounded-full" />
              </div>
              <div class="flex flex-wrap justify-center gap-6 max-w-4xl mx-auto">
                {lunchSponsors.map((sponsor) => (
                  <div class="flex-shrink-0 w-64 lg:w-60 bg-white border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                    <div class="bg-white rounded-lg p-4 flex items-center justify-center aspect-[4/2.5]">
                      <a
                        href={sponsor.href}
                        target="_blank"
                        rel="noopener noreferrer"
                        class="flex items-center justify-center w-full h-full"
                      >
                        <img
                          src={sponsor.src}
                          alt={sponsor.name}
                          loading="lazy"
                          class="block object-contain max-w-[90%] max-h-[90%]"
                        />
                      </a>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          )
        }
      </div>
    </div>
  </div>
</section>
