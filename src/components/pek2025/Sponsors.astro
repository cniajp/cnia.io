---
import { Picture } from 'astro:assets';
import { getCollection } from 'astro:content';
import type { ImageMetadata } from 'astro';

// rank毎にコンテンツを取得
const ranks = ['platinum', 'gold', 'silver', 'bronze', 'lunch'];
const results = await Promise.all(
  ranks.map(rank => getCollection('pek2025-job-boards', (board) => board.data.rank === rank))
);

const images = import.meta.glob<{ default: ImageMetadata }>('/src/assets/images/pek2025/sponsor/logo/*.{jpeg,jpg,png,gif}')
console.log('images', images);
results.forEach(result => {
  result.forEach(sponsor => {
    if (!images[sponsor.data.image]) throw new Error(`"${sponsor.data.name}:${sponsor.data.image}" does not exist in glob: "/src/assets/images/pek2025/sponsor/logo/*.{jpeg,jpg,png,gif}"`);
  });
})

const [
  platinumSponsors,
  goldSponsors,
  silverSponsors,
  bronzeSponsors,
  lunchSponsors,
] = results.map((result) => {
  return result.map((sponsor) => {
    return {
      src: sponsor.data.image,
      name: sponsor.data.name,
      href: sponsor.data.href,
    };
  });
});
---

<div class="max-w-6xl mx-auto">
    <div class="space-y-12">
    {/* Platinum Sponsors */}
    {platinumSponsors.length > 0 && (
        <div class="space-y-6">
        <div class="text-center">
            <h3 class="text-2xl font-bold text-pek2025-primary-700 mb-2">Platinum</h3>
            <div class="w-24 h-1 bg-gradient-to-r from-purple-300 to-purple-500 mx-auto rounded-full"></div>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 justify-items-center">
            {platinumSponsors.map((sponsor) => (
            <div class="bg-white border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                <div class="bg-white rounded-xl p-8 flex items-center justify-center min-h-[200px]">
                    <a href={sponsor.href} target="_blank" rel="noopener noreferrer" class="block w-full h-full flex items-center justify-center">
                    <Picture
                        src={images[sponsor.src]()}
                        alt={sponsor.name}
                        loading="lazy"
                        class="max-w-full max-h-32 object-contain"
                    />
                    </a>
                </div>
            </div>
            ))}
        </div>
        </div>
    )}

    {/* Gold Sponsors */}
    {goldSponsors.length > 0 && (
        <div class="space-y-6">
        <div class="text-center">
            <h3 class="text-2xl font-bold text-pek2025-primary-700 mb-2">Gold</h3>
            <div class="w-24 h-1 bg-gradient-to-r from-yellow-300 to-yellow-500 mx-auto rounded-full"></div>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 justify-items-center">
            {goldSponsors.map((sponsor) => (
            <div class="bg-white  border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                <div class="bg-white rounded-xl p-6 flex items-center justify-center min-h-[150px]">
                    <a href={sponsor.href} target="_blank" rel="noopener noreferrer" class="block w-full h-full flex items-center justify-center">
                    <Picture
                        src={images[sponsor.src]()}
                        alt={sponsor.name}
                        loading="lazy"
                        class="max-w-full max-h-24 object-contain"
                    />
                    </a>
                </div>
            </div>
            ))}
        </div>
        </div>
    )}

    {/* Silver Sponsors */}
    {silverSponsors.length > 0 && (
        <div class="space-y-6">
        <div class="text-center">
            <h3 class="text-2xl font-bold text-pek2025-primary-700 mb-2">Silver</h3>
            <div class="w-24 h-1 bg-gradient-to-r from-gray-200 to-gray-400 mx-auto rounded-full"></div>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4 justify-items-center">
            {silverSponsors.map((sponsor) => (
            <div class="bg-white border border-gray-200 p-[2px] rounded-xl shadow-md hover:shadow-xl transition-all duration-300">
                <div class="bg-white rounded-xl p-4 flex items-center justify-center min-h-[120px]">
                    <a href={sponsor.href} target="_blank" rel="noopener noreferrer" class="block w-full h-full flex items-center justify-center">
                    <Picture
                        src={images[sponsor.src]()}
                        alt={sponsor.name}
                        loading="lazy"
                        class="max-w-full max-h-20 object-contain"
                    />
                    </a>
                </div>
            </div>
            ))}
        </div>
        </div>
    )}

    {/* Bronze Sponsors */}
    {bronzeSponsors.length > 0 && (
        <div class="space-y-6">
        <div class="text-center">
            <h3 class="text-2xl font-bold text-pek2025-primary-600 mb-2">Bronze</h3>
            <div class="w-24 h-1 bg-gradient-to-r from-yellow-600 to-yellow-800 mx-auto rounded-full"></div>
        </div>
        <div class="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-3 justify-items-center">
            {bronzeSponsors.map((sponsor) => (
            <div class="bg-white border border-gray-200 p-[2px] rounded-lg shadow-md hover:shadow-xl transition-all duration-300">
                <div class="bg-white rounded-lg p-3 flex items-center justify-center min-h-[100px]">
                    <a href={sponsor.href} target="_blank" rel="noopener noreferrer" class="block w-full h-full flex items-center justify-center">
                    <Picture
                        src={images[sponsor.src]()}
                        alt={sponsor.name}
                        loading="lazy"
                        class="max-w-full max-h-16 object-contain"
                    />
                    </a>
                </div>
            </div>
            ))}
        </div>
        </div>
    )}

    {/* Lunch Sponsors */}
    {lunchSponsors.length > 0 && (
        <div class="space-y-6">
        <div class="text-center">
            <h3 class="text-2xl font-bold text-pek2025-primary-600 mb-2">Lunch</h3>
            <div class="w-24 h-1 bg-gradient-to-r from-green-300 to-green-500 mx-auto rounded-full"></div>
        </div>
        <div class="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-6 gap-3 justify-items-center">
            {lunchSponsors.map((sponsor) => (
            <div class="bg-white border border-gray-200 p-[2px] rounded-lg shadow-md hover:shadow-xl transition-all duration-300">
                <div class="bg-white rounded-lg p-3 flex items-center justify-center min-h-[100px]">
                    <a href={sponsor.href} target="_blank" rel="noopener noreferrer" class="block w-full h-full flex items-center justify-center">
                    <Picture
                        src={images[sponsor.src]()}
                        alt={sponsor.name}
                        loading="lazy"
                        class="max-w-full max-h-16 object-contain"
                    />
                    </a>
                </div>
            </div>
            ))}
        </div>
        </div>
    )}
    </div>
</div>
  
